{"version":3,"file":"index.js","sources":["../src/useLinkedIn.tsx","../src/utils.ts","../src/LinkedIn.tsx","../src/LinkedInCallback.tsx"],"sourcesContent":["import { useCallback, useEffect, useRef } from 'react';\nimport { useLinkedInType } from './types';\nimport { LINKEDIN_OAUTH2_STATE } from './utils';\nimport { Browser } from '@capacitor/browser';\n\nconst generateRandomString = (length = 20) => {\n  let result = '';\n  const characters =\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  const charactersLength = characters.length;\n  for (let i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n};\n\nexport function useLinkedIn({\n  redirectUri,\n  clientId,\n  onSuccess,\n  onError,\n  scope = 'r_emailaddress',\n  state = '',\n}: useLinkedInType) {\n  const popUpIntervalRef = useRef<number>(null);\n  const receiveMessage = useCallback(\n    (event: MessageEvent) => {\n      const savedState = localStorage.getItem(LINKEDIN_OAUTH2_STATE);\n      if (event.origin === window.location.origin) {\n        if (event.data.errorMessage && event.data.from === 'Linked In') {\n          // Prevent CSRF attack by testing state\n          if (event.data.state !== savedState) {\n            Browser.close();\n            return;\n          }\n          onError && onError(event.data);\n          Browser.close();\n        } else if (event.data.code && event.data.from === 'Linked In') {\n          // Prevent CSRF attack by testing state\n          if (event.data.state !== savedState) {\n            console.error('State does not match');\n            Browser.close();\n            return;\n          }\n          onSuccess && onSuccess(event.data.code);\n          Browser.close();\n        }\n      }\n    },\n    [onError, onSuccess],\n  );\n\n  useEffect(() => {\n    return () => {\n      window.removeEventListener('message', receiveMessage, false);\n\n      Browser.close();\n      if (popUpIntervalRef.current) {\n        window.clearInterval(popUpIntervalRef.current);\n        popUpIntervalRef.current = null;\n      }\n    };\n  }, [receiveMessage]);\n\n  useEffect(() => {\n    window.addEventListener('message', receiveMessage, false);\n    return () => {\n      window.removeEventListener('message', receiveMessage, false);\n    };\n  }, [receiveMessage]);\n\n  const getUrl = () => {\n    const scopeParam = `&scope=${encodeURI(scope)}`;\n    const generatedState = state || generateRandomString();\n    localStorage.setItem(LINKEDIN_OAUTH2_STATE, generatedState);\n    const linkedInAuthLink = `https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=${clientId}&redirect_uri=${redirectUri}${scopeParam}&state=${generatedState}`;\n    return linkedInAuthLink;\n  };\n\n  const linkedInLogin = () => {\n    Browser.close();\n    Browser.open({\n      url: getUrl(),\n    });\n\n    if (popUpIntervalRef.current) {\n      window.clearInterval(popUpIntervalRef.current);\n      popUpIntervalRef.current = null;\n    }\n  };\n\n  return {\n    linkedInLogin,\n  };\n}\n","export const LINKEDIN_OAUTH2_STATE = 'linkedin_oauth2_state';\n\nexport function parse(search) {\n  const query = search.substring(1);\n  const vars = query.split('&');\n  const parsed = {};\n  for (let i = 0; i < vars.length; i++) {\n    const pair = vars[i].split('=');\n    if (pair.length > 1) {\n      parsed[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n    }\n  }\n  return parsed;\n}\n","import { LinkedInType } from './types';\nimport { useLinkedIn } from './useLinkedIn';\n\nexport function LinkedIn({\n  children,\n  redirectUri,\n  clientId,\n  onSuccess,\n  onError,\n  state,\n  scope,\n  closePopupMessage,\n}: LinkedInType) {\n  const { linkedInLogin } = useLinkedIn({\n    redirectUri,\n    clientId,\n    onSuccess,\n    onError,\n    state,\n    scope,\n    closePopupMessage,\n  });\n  return children({ linkedInLogin });\n}\n","import { useEffect, useState } from 'react';\nimport { LINKEDIN_OAUTH2_STATE, parse } from './utils';\n\ntype ParamsType = {\n  state: string;\n  code?: string;\n  error?: string;\n  error_description?: string;\n};\n\nexport function LinkedInCallback() {\n  const [errorMessage, setErrorMessage] = useState<string>('');\n  useEffect(() => {\n    const params = parse(window.location.search) as ParamsType;\n    if (params.state !== localStorage.getItem(LINKEDIN_OAUTH2_STATE)) {\n      setErrorMessage('State does not match');\n    } else if (params.error) {\n      const errorMessage =\n        params.error_description || 'Login failed. Please try again.';\n      window.opener &&\n        window.opener.postMessage(\n          {\n            error: params.error,\n            state: params.state,\n            errorMessage,\n            from: 'Linked In',\n          },\n          window.location.origin,\n        );\n      // Close tab if user cancelled login\n      if (params.error === 'user_cancelled_login') {\n        window.close();\n      }\n    }\n    if (params.code) {\n      window.opener &&\n        window.opener.postMessage(\n          { code: params.code, state: params.state, from: 'Linked In' },\n          window.location.origin,\n        );\n    }\n  }, []);\n\n  return <div>{errorMessage}</div>;\n}\n"],"names":["useLinkedIn","_a","redirectUri","clientId","onSuccess","onError","_b","scope","_c","state","popUpIntervalRef","useRef","receiveMessage","useCallback","event","savedState","localStorage","getItem","origin","window","location","data","errorMessage","from","Browser","close","code","useEffect","removeEventListener","current","clearInterval","addEventListener","getUrl","scopeParam","encodeURI","generatedState","length","result","characters","charactersLength","i","charAt","Math","floor","random","generateRandomString","setItem","linkedInLogin","open","url","children","closePopupMessage","useState","setErrorMessage","params","search","vars","substring","split","parsed","pair","decodeURIComponent","parse","error","errorMessage_1","error_description","opener","postMessage","_jsx"],"mappings":"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"}