import{useRef as e,useCallback as o,useEffect as r,useState as n}from"react";import{Browser as t}from"@capacitor/browser";import{jsx as i}from"react/jsx-runtime";function a(n){var i=n.redirectUri,a=n.clientId,c=n.onSuccess,s=n.onError,d=n.scope,l=void 0===d?"r_emailaddress":d,u=n.state,w=void 0===u?"":u,f=e(null),g=o((function(e){var o=localStorage.getItem("linkedin_oauth2_state");if(e.origin===window.location.origin)if(e.data.errorMessage&&"Linked In"===e.data.from){if(e.data.state!==o)return void t.close();s&&s(e.data),t.close()}else if(e.data.code&&"Linked In"===e.data.from){if(e.data.state!==o)return void t.close();c&&c(e.data.code),t.close()}}),[s,c]);r((function(){return function(){window.removeEventListener("message",g,!1),t.close(),f.current&&(window.clearInterval(f.current),f.current=null)}}),[g]),r((function(){return window.addEventListener("message",g,!1),function(){window.removeEventListener("message",g,!1)}}),[g]);var p=function(){var e="&scope="+encodeURI(l),o=w||function(e){void 0===e&&(e=20);for(var o="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=r.length,t=0;t<e;t++)o+=r.charAt(Math.floor(Math.random()*n));return o}();return localStorage.setItem("linkedin_oauth2_state",o),"https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id="+a+"&redirect_uri="+i+e+"&state="+o};return{linkedInLogin:function(){t.close(),t.open({url:p()}),f.current&&(window.clearInterval(f.current),f.current=null)}}}function c(e){return(0,e.children)({linkedInLogin:a({redirectUri:e.redirectUri,clientId:e.clientId,onSuccess:e.onSuccess,onError:e.onError,state:e.state,scope:e.scope,closePopupMessage:e.closePopupMessage}).linkedInLogin})}function s(){var e=n(""),o=e[0],t=e[1];return r((function(){var e=function(e){for(var o=e.substring(1).split("&"),r={},n=0;n<o.length;n++){var t=o[n].split("=");t.length>1&&(r[decodeURIComponent(t[0])]=decodeURIComponent(t[1]))}return r}(window.location.search);if(e.state!==localStorage.getItem("linkedin_oauth2_state"))t("State does not match");else if(e.error){var o=e.error_description||"Login failed. Please try again.";window.opener&&window.opener.postMessage({error:e.error,state:e.state,errorMessage:o,from:"Linked In"},window.location.origin),"user_cancelled_login"===e.error&&window.close()}e.code&&window.opener&&window.opener.postMessage({code:e.code,state:e.state,from:"Linked In"},window.location.origin)}),[]),i("div",{children:o},void 0)}export{c as LinkedIn,s as LinkedInCallback,a as useLinkedIn};
//# sourceMappingURL=index.esm.js.map
