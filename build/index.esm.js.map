{"version":3,"file":"index.esm.js","sources":["../src/useLinkedInIOS.tsx","../src/utils.ts","../src/useLinkedInOld.tsx","../src/useLinkedIn.tsx","../src/LinkedIn.tsx","../src/LinkedInCallback.tsx"],"sourcesContent":["import { useCallback, useEffect, useRef } from 'react';\nimport { useLinkedInIOSType } from './types';\nimport { LINKEDIN_OAUTH2_STATE } from './utils';\n\nconst generateRandomString = (length = 20) => {\n  let result = '';\n  const characters =\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  const charactersLength = characters.length;\n  for (let i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n};\n\nexport function useLinkedInIOS({\n  redirectUri,\n  clientId,\n  onSuccess,\n  onError,\n  scope = 'r_emailaddress',\n  state = '',\n  Browser,\n}: useLinkedInIOSType) {\n  const popUpIntervalRef = useRef<number>(null);\n  const receiveMessage = useCallback(\n    (event: MessageEvent) => {\n      const savedState = localStorage.getItem(LINKEDIN_OAUTH2_STATE);\n      if (event.origin === window.location.origin) {\n        if (event.data.errorMessage && event.data.from === 'Linked In') {\n          // Prevent CSRF attack by testing state\n          if (event.data.state !== savedState) {\n            Browser.close();\n            return;\n          }\n          onError && onError(event.data);\n          Browser.close();\n        } else if (event.data.code && event.data.from === 'Linked In') {\n          // Prevent CSRF attack by testing state\n          if (event.data.state !== savedState) {\n            console.error('State does not match');\n            Browser.close();\n            return;\n          }\n          onSuccess && onSuccess(event.data.code);\n          Browser.close();\n        }\n      }\n    },\n    [Browser, onError, onSuccess],\n  );\n\n  useEffect(() => {\n    return () => {\n      window.removeEventListener('message', receiveMessage, false);\n\n      Browser.close();\n      if (popUpIntervalRef.current) {\n        window.clearInterval(popUpIntervalRef.current);\n        popUpIntervalRef.current = null;\n      }\n    };\n  }, [Browser, receiveMessage]);\n\n  useEffect(() => {\n    window.addEventListener('message', receiveMessage, false);\n    return () => {\n      window.removeEventListener('message', receiveMessage, false);\n    };\n  }, [receiveMessage]);\n\n  const getUrl = () => {\n    const scopeParam = `&scope=${encodeURI(scope)}`;\n    const generatedState = state || generateRandomString();\n    localStorage.setItem(LINKEDIN_OAUTH2_STATE, generatedState);\n    const linkedInAuthLink = `https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=${clientId}&redirect_uri=${redirectUri}${scopeParam}&state=${generatedState}`;\n    return linkedInAuthLink;\n  };\n\n  const linkedInLogin = () => {\n    Browser.close();\n    Browser.open({\n      url: getUrl(),\n    });\n\n    if (popUpIntervalRef.current) {\n      window.clearInterval(popUpIntervalRef.current);\n      popUpIntervalRef.current = null;\n    }\n  };\n\n  return {\n    linkedInLogin,\n  };\n}\n","export const LINKEDIN_OAUTH2_STATE = 'linkedin_oauth2_state';\n\nexport function parse(search) {\n  const query = search.substring(1);\n  const vars = query.split('&');\n  const parsed = {};\n  for (let i = 0; i < vars.length; i++) {\n    const pair = vars[i].split('=');\n    if (pair.length > 1) {\n      parsed[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n    }\n  }\n  return parsed;\n}\n","import { useCallback, useEffect, useRef } from 'react';\nimport { useLinkedInType } from './types';\nimport { LINKEDIN_OAUTH2_STATE } from './utils';\n\nconst getPopupPositionProperties = ({ width = 600, height = 600 }) => {\n  const left = screen.width / 2 - width / 2;\n  const top = screen.height / 2 - height / 2;\n  return `left=${left},top=${top},width=${width},height=${height}`;\n};\n\nconst generateRandomString = (length = 20) => {\n  let result = '';\n  const characters =\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  const charactersLength = characters.length;\n  for (let i = 0; i < length; i++) {\n    result += characters.charAt(Math.floor(Math.random() * charactersLength));\n  }\n  return result;\n};\n\nexport function useLinkedInOld({\n  redirectUri,\n  clientId,\n  onSuccess,\n  onError,\n  scope = 'r_emailaddress',\n  state = '',\n  closePopupMessage = 'User closed the popup',\n}: useLinkedInType) {\n  const popupRef = useRef<Window>(null);\n  const popUpIntervalRef = useRef<number>(null);\n\n  const receiveMessage = useCallback(\n    (event: MessageEvent) => {\n      const savedState = localStorage.getItem(LINKEDIN_OAUTH2_STATE);\n      if (event.origin === window.location.origin) {\n        if (event.data.errorMessage && event.data.from === 'Linked In') {\n          // Prevent CSRF attack by testing state\n          if (event.data.state !== savedState) {\n            popupRef.current && popupRef.current.close();\n            return;\n          }\n          onError && onError(event.data);\n          popupRef.current && popupRef.current.close();\n        } else if (event.data.code && event.data.from === 'Linked In') {\n          // Prevent CSRF attack by testing state\n          if (event.data.state !== savedState) {\n            console.error('State does not match');\n            popupRef.current && popupRef.current.close();\n            return;\n          }\n          onSuccess && onSuccess(event.data.code);\n          popupRef.current && popupRef.current.close();\n        }\n      }\n    },\n    [onError, onSuccess],\n  );\n\n  useEffect(() => {\n    return () => {\n      window.removeEventListener('message', receiveMessage, false);\n\n      if (popupRef.current) {\n        popupRef.current.close();\n        popupRef.current = null;\n      }\n      if (popUpIntervalRef.current) {\n        window.clearInterval(popUpIntervalRef.current);\n        popUpIntervalRef.current = null;\n      }\n    };\n  }, [receiveMessage]);\n\n  useEffect(() => {\n    window.addEventListener('message', receiveMessage, false);\n    return () => {\n      window.removeEventListener('message', receiveMessage, false);\n    };\n  }, [receiveMessage]);\n\n  const getUrl = () => {\n    const scopeParam = `&scope=${encodeURI(scope)}`;\n    const generatedState = state || generateRandomString();\n    localStorage.setItem(LINKEDIN_OAUTH2_STATE, generatedState);\n    const linkedInAuthLink = `https://www.linkedin.com/oauth/v2/authorization?response_type=code&client_id=${clientId}&redirect_uri=${redirectUri}${scopeParam}&state=${generatedState}`;\n    return linkedInAuthLink;\n  };\n\n  const linkedInLogin = () => {\n    popupRef.current?.close();\n    popupRef.current = window.open(\n      getUrl(),\n      '_blank',\n      getPopupPositionProperties({ width: 600, height: 600 }),\n    );\n\n    if (popUpIntervalRef.current) {\n      window.clearInterval(popUpIntervalRef.current);\n      popUpIntervalRef.current = null;\n    }\n    popUpIntervalRef.current = window.setInterval(() => {\n      try {\n        if (popupRef.current && popupRef.current.closed) {\n          window.clearInterval(popUpIntervalRef.current);\n          popUpIntervalRef.current = null;\n          if (onError) {\n            onError({\n              error: 'user_closed_popup',\n              errorMessage: closePopupMessage,\n            });\n          }\n        }\n      } catch (error) {\n        console.error(error);\n        window.clearInterval(popUpIntervalRef.current);\n        popUpIntervalRef.current = null;\n      }\n    }, 1000);\n  };\n\n  return {\n    linkedInLogin,\n  };\n}\n","import { useLinkedInIOSType, useLinkedInType } from './types';\nimport { useLinkedInIOS } from './useLinkedInIOS';\nimport { useLinkedInOld } from './useLinkedInOld';\n\nexport function useLinkedIn(props: useLinkedInType) {\n  const isIOS = !!props.Browser;\n  const iosLogin = useLinkedInIOS(props as useLinkedInIOSType);\n  const oldLogin = useLinkedInOld(props);\n  const linkedInLogin = isIOS ? iosLogin : oldLogin;\n\n  return {\n    linkedInLogin,\n  };\n}\n","import { LinkedInType } from './types';\nimport { useLinkedIn } from './useLinkedIn';\n\nexport function LinkedIn({\n  children,\n  redirectUri,\n  clientId,\n  onSuccess,\n  onError,\n  state,\n  scope,\n  closePopupMessage,\n}: LinkedInType) {\n  const { linkedInLogin } = useLinkedIn({\n    redirectUri,\n    clientId,\n    onSuccess,\n    onError,\n    state,\n    scope,\n    closePopupMessage,\n  });\n  return children({ linkedInLogin });\n}\n","import { useEffect, useState } from 'react';\nimport { LINKEDIN_OAUTH2_STATE, parse } from './utils';\n\ntype ParamsType = {\n  state: string;\n  code?: string;\n  error?: string;\n  error_description?: string;\n};\n\nexport function LinkedInCallback() {\n  const [errorMessage, setErrorMessage] = useState<string>('');\n  useEffect(() => {\n    const params = parse(window.location.search) as ParamsType;\n    if (params.state !== localStorage.getItem(LINKEDIN_OAUTH2_STATE)) {\n      setErrorMessage('State does not match');\n    } else if (params.error) {\n      const errorMessage =\n        params.error_description || 'Login failed. Please try again.';\n      window.opener &&\n        window.opener.postMessage(\n          {\n            error: params.error,\n            state: params.state,\n            errorMessage,\n            from: 'Linked In',\n          },\n          window.location.origin,\n        );\n      // Close tab if user cancelled login\n      if (params.error === 'user_cancelled_login') {\n        window.close();\n      }\n    }\n    if (params.code) {\n      window.opener &&\n        window.opener.postMessage(\n          { code: params.code, state: params.state, from: 'Linked In' },\n          window.location.origin,\n        );\n    }\n  }, []);\n\n  return <div>{errorMessage}</div>;\n}\n"],"names":["useLinkedInIOS","_a","redirectUri","clientId","onSuccess","onError","_b","scope","_c","state","Browser","popUpIntervalRef","useRef","receiveMessage","useCallback","event","savedState","localStorage","getItem","origin","window","location","data","errorMessage","from","close","code","useEffect","removeEventListener","current","clearInterval","addEventListener","getUrl","scopeParam","encodeURI","generatedState","length","result","characters","charactersLength","i","charAt","Math","floor","random","generateRandomString","setItem","linkedInLogin","open","url","useLinkedInOld","_d","closePopupMessage","popupRef","width","height","screen","getPopupPositionProperties","setInterval","closed","error","useLinkedIn","props","isIOS","iosLogin","oldLogin","LinkedIn","children","LinkedInCallback","useState","setErrorMessage","params","search","vars","substring","split","parsed","pair","decodeURIComponent","parse","errorMessage_1","error_description","opener","postMessage","_jsx"],"mappings":"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"}